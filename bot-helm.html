<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prueba del Web Bot</title>

  <!-- Estilos del widget n8n -->
  <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />

  <!-- Estilos propios de la secci√≥n aislada -->
  <style>
    :root{
      --verde:#2a5c2a; --bg:#f6f7f8; --card:#ffffff; --shadow:0 12px 30px rgba(0,0,0,.12);
      --radius:16px;
    }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); }
    .sandbox{
      min-height:100vh; display:grid; place-items:center; padding:clamp(16px,3vw,32px);
    }
    .card{
      width:min(980px,94vw); background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:clamp(16px,3vw,28px);
    }
    .card h1{ margin:0 0 6px; font-size:clamp(22px,3vw,28px); }
    .card p{ margin:0 0 16px; color:#444 }
    .row{ display:flex; gap:16px; flex-wrap:wrap; align-items:center; }
    .btn{
      appearance:none; border:0; border-radius:999px; padding:12px 18px; cursor:pointer;
      background:var(--verde); color:#fff; box-shadow:0 8px 22px rgba(0,0,0,.16);
      font-weight:600;
    }
    .hint{ font-size:.92rem; color:#666 }
    /* Contenedor opcional para modo "embedded" (por si quer√©s probarlo luego) */
    #n8n-chat-embed{
      display:none; /* en este ejemplo usamos modo "window"; si prob√°s "embedded", pon√© display:block */
      width:100%; height:70vh; border:1px solid #e5e7eb; border-radius:12px; overflow:hidden;
    }
  </style>
</head>
<body>
  <main class="sandbox">
    <section class="card" aria-label="Zona de pruebas del bot">
      <h1>Zona de prueba del Web Bot</h1>
      <p>Este bloque est√° aislado del resto de tu sitio para que puedas testear el chatbot sin interferencias.</p>

      <div class="row">
        <button class="btn" id="openChatBtn" type="button">Abrir chat</button>
        <a class="hint" href="https://jjg.app.n8n.cloud/webhook/ccec108a-e30a-48fd-b832-cec3042eda00/chat" target="_blank" rel="noopener">Abrir en pesta√±a nueva (fallback)</a>
      </div>

      <!-- Contenedor para pruebas en modo "embedded" (opcional) -->
      <div id="n8n-chat-embed" role="region" aria-label="Chat embebido"></div>
    </section>
  </main>

  <!-- Script del widget n8n -->
  <script type="module">
    import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

    // === CONFIGURACI√ìN PRINCIPAL ===
    const chat = createChat({
      webhookUrl: 'https://jjg.app.n8n.cloud/webhook/ccec108a-e30a-48fd-b832-cec3042eda00/chat',
      webhookConfig: { method: 'POST', headers: {} },

      // MODO DE RENDER: "window" (ventana flotante). Si quer√©s embebido, cambi√° a mode:"embedded" y target:"#n8n-chat-embed"
      mode: 'window',

      // Para "embedded" usar: target: '#n8n-chat-embed'
      target: '#n8n-chat-embed',

      chatInputKey: 'chatInput',
      chatSessionKey: 'sessionId',
      loadPreviousSession: true,
      metadata: {},
      showWelcomeScreen: false,
      defaultLanguage: 'es',
      initialMessages: ['¬°Hola! üëã', '¬øEn qu√© te puedo ayudar hoy?'],
      i18n: {
        es: {
          title: 'Soy tu asistente de Reviton ü§ñ',
          subtitle: 'Estoy 24/7 para ayudarte',
          footer: '',
          getStarted: 'Nueva conversaci√≥n',
          inputPlaceholder: 'Escrib√≠ tu consulta',
        },
      },
      enableStreaming: false,
    });

    // Opcional: expone el objeto para abrir/cerrar desde botones propios
    window.n8nChat = chat;

    // Bot√≥n "Abrir chat" (modo "window")
    document.getElementById('openChatBtn')?.addEventListener('click', (e) => {
      e.preventDefault();
      // Para window: open() abre la ventana del chat; para embedded no hace falta
      window.n8nChat?.open?.();
    });

    // Si quisieras probar EMBEDDED:
    // 1) Cambi√° arriba a: mode: 'embedded'
    // 2) Asegurate que #n8n-chat-embed tenga display:block (quitar display:none en CSS)
  </script>
</body>
</html>
